app.controller("loginCtrl",['$scope','srvAuth','$rootScope','$sessionStorage','$location','$http','$timeout',function($scope,sAuth,$rootScope,$sessionStorage,$location,$http,$timeout){$scope.sessionStorage=$sessionStorage;if($sessionStorage.user){$location.path('/member')}$scope.facebookLogin=function(){if(!$scope.sessionStorage.user){sAuth.fblogin()
$location.path('/member')}else{console.log('User already logged!')}}
$scope.login=function(){var data={email:$scope.login.email,password:$scope.login.password}
if(!$sessionStorage.user){$http({method:'POST',url:'https://robisie.co/api/index.php',data:{operation:'login',user:data}}).then(function successCallback(response){if(response.data.result==='success'){$sessionStorage.user={};$sessionStorage.user.email=data.email;$sessionStorage.GID=null;$sessionStorage.FID=null;$scope.loginMessage='';if(response.data.user.is_Admin==='1'){$sessionStorage.adminAccess=true;}if($sessionStorage.whatChoice){$location.path('/member')}else{$location.path('/member/what-choice')}}else if(response.data.result==='failure'&&response.data.message==='Invaild Login Credentials'){$scope.loginMessage='Nieprawidłowy email lub hasło';}},function errorCallback(response){});}else{console.log('already logged')}}
var initClient=(function(){$timeout(function(){gapi.load('auth2',function(){auth2=gapi.auth2.init({client_id:'266563875998-fqfesenrm4lmhqb14e82n4fe24nrrumc.apps.googleusercontent.com',scope:'profile'});auth2.attachClickHandler('signin-button',{},sAuth.onSuccess,sAuth.onFailure);});},100)})();}]);