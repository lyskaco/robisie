app.controller("registerCtrl",['$scope','srvAuth','$sessionStorage','$location','$http','$mdDialog','$timeout',function($scope,sAuth,$sessionStorage,$location,$http,$mdDialog,$timeout){$scope.sessionStorage=$sessionStorage;if($sessionStorage.user){$location.path('/hello')}$scope.facebookLogin=function(){if(!$scope.sessionStorage.user){sAuth.fblogin()}else{console.log('User already logged!')}}
$scope.register=function(){var data={first_name:$scope.register.first_name,last_name:$scope.register.last_name,email:$scope.register.email,password:$scope.register.password}
function send(){$http({method:'POST',url:'https://robisie.co/api/index.php',data:{operation:'register',user:data}}).then(function successCallback(response){if(response.data.result==='success'){$sessionStorage.user=data;$sessionStorage.GID=null;$sessionStorage.FBToken=null;if($sessionStorage.whatChoice){$location.path('/member')}else{$location.path('/member/what-choice')}}else if(response.data.result==='failure'&&response.data.message==='User Already Registered !'){$scope.messageRegister="Użytkownik o takim mailu już istnieje!"}},function errorCallback(response){});}if(!$sessionStorage.user){send()}else{$scope.message='Użytownik o takim mailu już istnieje'}}
var initClient=(function(){$timeout(function(){gapi.load('auth2',function(){auth2=gapi.auth2.init({client_id:'266563875998-fqfesenrm4lmhqb14e82n4fe24nrrumc.apps.googleusercontent.com',scope:'profile'});auth2.attachClickHandler('signin-button-register',{},sAuth.onSuccess,sAuth.onFailure);});},200)})();}]);