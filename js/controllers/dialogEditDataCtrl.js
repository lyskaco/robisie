app.controller("dialogEditDataCtrl",function($scope,user,$mdDialog,$http,$sessionStorage){$scope.user=user;$scope.FID=$sessionStorage.FID;$scope.GID=$sessionStorage.GID;$scope.email=$sessionStorage.user.email;$scope.close=function(){$mdDialog.hide($scope.user.picture)}
$scope.forms={};$scope.showAlert=function(message){$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector('#popupContainer'))).clickOutsideToClose(true).title('Komunikat').textContent(message).ariaLabel('Alert Dialog Demo').ok('OK'));};$scope.save=function(){var formData=new FormData();$scope.imgLoading=true;formData.append('file',$scope.image);formData.append('email',$scope.email);$http({method:'POST',url:"https://robisie.co/api/upload.php",data:formData,headers:{'Content-Type':undefined},transformRequest:angular.identity}).success(function(response){$scope.imgLoading=false;if(response.result==='success'){$scope.avatarMessage='Wgrano nowy avatar';$scope.user.picture=response.picture_url;}else{$scope.avatarMessage='Coś poszło nietak';}}).error(function(data,status,headers,config){$scope.imgLoading=false;});};$scope.changePassword=function(){var data={email:$scope.user.email,old_password:$scope.changepassword.oldpassword,new_password:$scope.changepassword.newpassword}
$http({method:'POST',url:'https://robisie.co/api/index.php',data:{operation:'chgPass',user:data}}).then(function successCallback(response){if(response.data.result==='success'&&response.data.message==='Password Changed Successfully'){var message='Hasło zmienione';$scope.showAlert(message);}else if(response.data.result==='failure'&&response.data.message==='Invalid Old Password'){var message='Stare hasło niepoprawne';$scope.showAlert(message);}},function errorCallback(response){});}
$scope.changeData=function(){var user={email:$scope.user.email,phone:$scope.change_data.telephone,address:$scope.change_data.address}
$http({method:'POST',url:'https://robisie.co/api/index.php',data:{operation:'updatedata',user:user}}).then(function successCallback(response){if(response.data.result=='success'){$scope.changeDataMessage='Dane zmienione.';}else{$scope.changeDataMessage='Coś poszło nie tak';}$scope.change_data={};$scope.forms.changeData.$setUntouched()},function errorCallback(response){});}})